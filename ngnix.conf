server {
  listen 80;
  server_name _;

  # Angular SPA
  root  /usr/share/nginx/html;
  index index.html;

  # Sirve la app y hace fallback al index.html
  location / {
    try_files $uri $uri/ /index.html;
  }

  # --- Ajustes comunes de proxy ---
  proxy_redirect          off;
  proxy_http_version      1.1;
  proxy_set_header Host   $host;
  proxy_set_header X-Real-IP $remote_addr;
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header X-Forwarded-Proto $scheme;
  proxy_connect_timeout   10s;
  proxy_send_timeout      90s;
  proxy_read_timeout      90s;

  # === Rutas hacia tus microservicios (mismo docker network) ===
  # OJO: estos hostnames deben ser los container_name de tu docker-compose

  # Catalogos (ej: /catalogos/tpusuarios)
  location /catalogos/ {
    proxy_pass http://siau_catalogos:8080/catalogos/;
  }

  # Usuarios (ej: /usuarios/login, /usuarios/tpusuario)
  location /usuarios/ {
    proxy_pass http://siau_usuarios:8080/;
  }

  # Solicitudes (ej: /solicitudes/...)
  location /solicitudes/ {
    proxy_pass http://siau_solicitudes:8080/;
  }

  # Captcha (tu servicio expone /api/captcha y /api/captcha/verify)
  location /api/captcha {
    proxy_pass http://siau_captcha:8080/api/captcha;
  }
  location /api/captcha/ {
    proxy_pass http://siau_captcha:8080/api/captcha/;
  }
  # Por si tu front llama /captcha/... en vez de /api/captcha
  location /captcha/ {
    proxy_pass http://siau_captcha:8080/;
  }
}
