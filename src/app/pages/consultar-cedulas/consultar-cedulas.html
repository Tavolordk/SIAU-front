<!-- Página full width dentro del Shell (sin header/aside locales) -->
<div class="page-shell">

  <h1 class="main-title">Consultar Cédulas</h1>
  <button class="new-request-btn" type="button" (click)="nuevaSolicitud()">Nueva solicitud</button>

  <!-- Filtros -->
  <div class="filter-card shadow-sm" [formGroup]="form">
    <div class="d-flex flex-wrap align-items-center mb-2 gap-2">

      <!-- Información Personal -->
      <div class="filter-dropdown" [class.open]="open==='personal'">
        <button class="btn btn-light dropdown-toggle w-100 text-start" type="button"
                (click)="toggleDropdown('personal', $event)">
          Información Personal
          <fa-icon [icon]="icons.chevronDown" class="float-end"></fa-icon>
        </button>

        <div class="dropdown-menu" *ngIf="open==='personal'" (click)="$event.stopPropagation()">
          <div class="row g-2">
            <div class="col-6"><label>Usuario</label><input type="text" class="form-control" formControlName="cuenta_codigo" /></div>
            <div class="col-6"><label>Nombre (s)</label><input type="text" class="form-control" formControlName="nombres" /></div>
            <div class="col-6"><label>Primer Apellido</label><input type="text" class="form-control" formControlName="primer_apellido" /></div>
            <div class="col-6"><label>Segundo Apellido</label><input type="text" class="form-control" formControlName="segundo_apellido" /></div>
            <div class="col-6"><label>CURP</label><input type="text" class="form-control" formControlName="curp" /></div>
            <div class="col-6"><label>RFC</label><input type="text" class="form-control" formControlName="rfc" /></div>
          </div>
        </div>
      </div>

      <!-- Información de Solicitud -->
      <div class="filter-dropdown" [class.open]="open==='solicitud'">
        <button class="btn btn-light dropdown-toggle w-100 text-start" type="button"
                (click)="toggleDropdown('solicitud', $event)">
          Información de Solicitud
          <fa-icon [icon]="icons.chevronDown" class="float-end"></fa-icon>
        </button>

        <div class="dropdown-menu" *ngIf="open==='solicitud'" (click)="$event.stopPropagation()">
          <div class="row g-2">
            <div class="col-6"><label>Fecha Desde:</label><input type="date" class="form-control" formControlName="fecha_desde" /></div>
            <div class="col-6"><label>Hasta:</label><input type="date" class="form-control" formControlName="fecha_hasta" /></div>
            <div class="col-6"><label>Folio</label><input type="text" class="form-control" formControlName="folio" /></div>
            <div class="col-6">
              <label>Tipo de Solicitud</label>
              <select class="form-select" formControlName="tipo_tramite">
                <option value="">Seleccionar...</option>
                <option value="Nueva Cuenta">Nueva Cuenta</option>
                <option value="Modificación de Perfil / Adscripción">Modificación de Perfil / Adscripción</option>
                <option value="Reactivación de Cuenta">Reactivación de Cuenta</option>
                <option value="Ampliación de Perfiles">Ampliación de Perfiles</option>
              </select>
            </div>
            <div class="col-6">
              <label>Estatus</label>
              <select class="form-select" formControlName="estatus">
                <option value="">Seleccionar...</option>
                <option value="Recibida">Recibida</option>
                <option value="Guardada">Guardada</option>
                <option value="Validada">Validada</option>
                <option value="Aprobada">Aprobada</option>
                <option value="Cancelada">Cancelada</option>
                <option value="Rechazada">Rechazada</option>
                <option value="Pendiente">Pendiente</option>
                <option value="En espera">En espera</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- Información Institucional/Estatal -->
      <div class="filter-dropdown" [class.open]="open==='institucional'">
        <button class="btn btn-light dropdown-toggle w-100 text-start" type="button"
                (click)="toggleDropdown('institucional', $event)">
          Información Institucional/Estatal
          <fa-icon [icon]="icons.chevronDown" class="float-end"></fa-icon>
        </button>

        <div class="dropdown-menu" *ngIf="open==='institucional'" (click)="$event.stopPropagation()">
          <div class="row g-2">
            <div class="col-6">
              <label>Tipo de Institución</label>
              <select class="form-select" formControlName="tipo_institucion">
                <option value="">Seleccionar...</option>
                <option value="Municipal">Municipal</option>
                <option value="Estatal">Estatal</option>
                <option value="Federal">Federal</option>
              </select>
            </div>
            <div class="col-6">
              <label>Entidad</label>
              <input type="text" class="form-control" formControlName="entidad" />
            </div>
            <div class="col-6">
              <label>Municipio</label>
              <input type="text" class="form-control" formControlName="municipio" />
            </div>
            <div class="col-6">
              <label>Institución</label>
              <input type="text" class="form-control" formControlName="institucion" />
            </div>
            <div class="col-6">
              <label>Dependencia</label>
              <input type="text" class="form-control" formControlName="dependencia" />
            </div>
            <div class="col-6">
              <label>Corporación</label>
              <input type="text" class="form-control" formControlName="corporacion" />
            </div>
            <div class="col-6">
              <label>Área</label>
              <input type="text" class="form-control" formControlName="area" />
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Chips informativos (estáticos de ejemplo) -->
    <div class="d-flex flex-wrap align-items-center mb-2 gap-2">
      <span class="filter-info">Fecha: {{ form.value.fecha_desde || '----' }} / {{ form.value.fecha_hasta || '----' }} <i class="far fa-calendar-alt"></i></span>
      <span class="filter-info" *ngIf="form.value.entidad">Entidad: {{ form.value.entidad }} <i class="fas fa-map-marker-alt"></i></span>
      <span class="filter-info" *ngIf="form.value.tipo_tramite">Tipo de Solicitud: {{ form.value.tipo_tramite }} <i class="fas fa-file-alt"></i></span>
    </div>

    <div class="d-flex flex-wrap align-items-center mb-2 gap-2">
      <button class="filter-btn" type="button" (click)="onBuscar()" [disabled]="loading">Buscar</button>
      <button class="filter-btn-secondary" type="button" (click)="onLimpiar()" [disabled]="loading">Limpiar</button>
      <span *ngIf="loading" class="ms-2">Cargando…</span>
      <span *ngIf="!loading && error" class="text-danger ms-2">{{ error }}</span>
      <span *ngIf="!loading && !error" class="ms-2">Total: {{ total }}</span>
    </div>
  </div>

  <!-- Tabla -->
  <div class="table-card shadow-sm mt-4">
    <div class="table-scroll">
      <table class="table custom-table mb-0">
        <thead>
          <tr>
            <th style="width:32px;"></th>
            <th>Folio</th>
            <th>Fecha</th>
            <th>Nombre(s)</th>
            <th>Primer Apellido</th>
            <th>Segundo Apellido</th>
            <th>Usuario</th>
            <th>Tipo de Solicitud</th>
            <th>Tipo de Institución</th>
            <th>Entidad, Municipio</th>
            <th>Institución, Dependencia, Corporación</th>
            <th>Información relacionada en RNPSP</th>
            <th>Información relacionada en SAU</th>
            <th>Resultado integral ECCC</th>
            <th>Estatus</th>
            <th>Acciones</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let row of pageRows; trackBy: trackByFolio">
            <td><input type="checkbox" class="table-checkbox"></td>
            <td>{{ row.folio }}</td>
            <td>{{ row.fecha }}</td>
            <td>{{ row.nombres }}</td>
            <td>{{ row.primerApellido }}</td>
            <td>{{ row.segundoApellido }}</td>
            <td>{{ row.usuario }}</td>
            <td>{{ row.tipoSolicitud }}</td>
            <td>{{ row.tipoInstitucion }}</td>
            <td>{{ row.entidadMunicipio }}</td>
            <td>{{ row.instDepCorp }}</td>
            <td>{{ row.rnpsp }}</td>
            <td>{{ row.sau }}</td>
            <td>{{ row.resultadoEccc }}</td>
            <td><span class="status-badge" [ngClass]="row.estatusClase">{{ row.estatusTexto }}</span></td>
            <td class="action-icons">
              <button class="icon-btn" type="button" (click)="onComment(row)"><fa-icon [icon]="icons.comment"></fa-icon></button>
              <button class="icon-btn" type="button" (click)="onDocs(row)"><fa-icon [icon]="icons.file"></fa-icon></button>
              <button class="icon-btn" type="button" (click)="onView(row)"><fa-icon [icon]="icons.eye"></fa-icon></button>
            </td>
          </tr>
        </tbody>

      </table>
    </div>

    <div class="table-footer">
      <button class="approve-btn" type="button" (click)="onAprobar()">Aprobar</button>
      <app-pagination
        [items]="rows"
        [pageSize]="pageSize"
        [hideOnSinglePage]="false"
        (pageItemsChange)="pageRows = $event">
      </app-pagination>
    </div>
  </div>
</div>
